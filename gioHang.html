 <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thanh toán</title>
    <link href="css/jquery.bxslider.css" rel="stylesheet">
    <link rel="stylesheet" href="css/cart.css">
    <link rel="stylesheet" href="css/gioHang.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="fonts/fontawesome-free-5.13.0-web/css/all.min.css">
    <script src="until.js"></script>
    <script src="sanPham.js"></script>
    <script src="gioHang.js"></script> 
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <header id="header">


        
        <div id="noidung-header">
            <nav class="navbartren">
                <ul class="noidung-navbar-tren-trai">
                    <li class="nd1 hiennd phancachchedoc">
                        <a href="#">Tải ứng dụng</a>
                        <div class="qrcode">
                            <img src="images/f184c0b68a2d385feb5d70a76396230b.png" alt="QR Code" class="qrcode_qr">
                            <div class="qrcode_ap">
                                <a href="#" class="qrcode_ap_link"><img src="images/2679f513b5f9e235adf2c6c288617e7b.png" alt="Google Play"></a>
                                <a href="#" class="qrcode_ap_link"><img src="images/759416b55e2bd69ecc360ee2faab7ad0.png" alt="App Store"></a>
                            </div>
                        </div>
                    </li>
                    <li class="nd1">
                        <a href="#">Kết nối</a>
                        <a href="#"><i class="fab fa-facebook"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                    </li>
                </ul>
                <ul class="noidung-navbar-tren-trai">
                    <li class="nd1 hiennd">
                        <a href="#"><i class="fas fa-bell"></i>Thông báo</a>
                        <div class="thongbao">
                            <img class="thongbao-hinhanh" src="images/5a83ec8ec1bc1ea687fdf9c6e68eee0b.png" alt="">
                            <div class="nhacnho">Đăng nhập để xem thông báo</div>
                            <div class="dangki">
                                <a href="#">Đăng ký</a>
                            </div>
                            <div class="dangnhap">
                                <a href="#">Đăng nhập</a>
                            </div>
                        </div>
                    </li>                    
                    <li class="nd1">
                        <a href="#"><i class="far fa-question-circle"></i>Trợ giúp</a>
                    </li>
                    <li class="nd1 phancachchedoc"><a href="#">Đăng ký</a></li>
                    <li class="nd1"><a href="Them_moi_san_pham.html" target="blank">Đăng nhập</a></li>
                </ul>
            </nav>
            <div class="header-logo">
                <a href="index.html"><img src="images/pinterest_board_photo.png" alt=""></a>
            </div>  
            <div class="header-giua">
                <div class="menu">
                    <nav id="nav-bar">
                        <ul class="menu-lv1">
                            <li class="item-lv1">
                                <a href="index.html" class="item-lv1-title">TRANG CHỦ</a>
                            </li>
                            <li class="item-lv1">
                                <a href="#" class="item-lv1-title">SẢN PHẨM</a>
                                <ul class="menu-lv2">
                                    <li class="item-lv2">
                                        <a href="#" class="item-lv2-title">NOKIA</a>
                                    </li>
                                    <li class="item-lv2">
                                        <a href="#" class="item-lv2-title">SAMSUNG</a>
                                    </li>
                                    <li class="item-lv2">
                                        <a href="#" class="item-lv2-title">APPLE</a>
                                    </li>
                                    <li class="item-lv2">
                                        <a href="#" class="item-lv2-title">HUAWEI</a>
                                    </li>
                                    <li class="item-lv2">
                                        <a href="#" class="item-lv2-title">LG</a>
                                    </li>
                                    <li class="item-lv2">
                                        <a href="#" class="item-lv2-title">SONY</a>
                                    </li>
                                </ul>
                            </li>
                            <li class="item-lv1">
                                <a href="#" class="item-lv1-title">PHỤ KIỆN</a>
                                <ul class="menu-lv2">
                                    <li class="item-lv2">
                                        <a href="#" class="item-lv2-title">Điện thoại</a>
                                    </li>
                                    <li class="item-lv2">
                                        <a href="#" class="item-lv2-title">Đồ gia dụng</a>
                                    </li>
                                </ul>
                            </li>
                            <li class="item-lv1">
                                <a href="index.html" class="item-lv1-title">TUYỂN DỤNG</a>
                            </li>
                            <li class="item-lv1">
                                <a href="#" class="item-lv1-title">KHUYỄN MÃI</a>
                                <ul class="menu-lv2">
                                    <li class="item-lv2">
                                        <a href="#" class="item-lv2-title">NOKIA</a>
                                    </li>
                                    <li class="item-lv2">
                                        <a href="#" class="item-lv2-title">SAMSUNG</a>
                                    </li>
                                    <li class="item-lv2">
                                        <a href="#" class="item-lv2-title">APPLE</a>
                                    </li>
                                    <li class="item-lv2">
                                        <a href="#" class="item-lv2-title">HUAWEI</a>
                                    </li>
                                    <li class="item-lv2">
                                        <a href="#" class="item-lv2-title">LG</a>
                                    </li>
                                    <li class="item-lv2">
                                        <a href="#" class="item-lv2-title">SONY</a>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                    </nav>
                </div>
                <div class="timkiem">
                    
                    <input type="text" class="noidung-timkiem" placeholder="Tìm kiếm trong Shop">
                    
                    <div class="timkiemtrong-select">
                        <span class="label">Trong Shop</span>
                        <i class="fas fa-angle-down"></i>
                        <ul class="timkiem-option">
                            <li class="timkiemitem">
                                <span>Trong Shop</span>
                                <i class="fas fa-check"></i>
                            </li>
                            <li class="timkiemitem">
                                <span>Ngoài Shop</span>
                            </li>
                        </ul>
                    </div>
                    <button class="btn-timkiem">
                        <i class="btn-timkiemlg fas fa-search"></i>
                    </button>
                </div>   
            </div>  
            <div class="header-muahang">
                <a href="gioHang.html"><i class="fas fa-cart-arrow-down"></i></a>
            </div> 
        </div>  
    </header>
    
    <main id="main-giohang" onclick="">
        <h1 class="cart-title">
            Sản phẩm bạn đã chọn mua
        </h1>
        <div class="menugiohang">
            <div class="hinh">Hình ảnh sản phẩm</div>
            <div class="tenspp">Tên sản phẩm</div>
            <div class="giaspp">Giá</div>
            <div class="soluongspp">Số lượng</div>
            <div class="thanhtien">Tổng tiền</div>
            <div class="thaotacxoa"></div>            
        </div>
        <div class="gioHang" id="gioHang">
            <div class="item-giohang">
                <div class="hinhanh">
                    <img src="https://cdn.tgdd.vn/Products/Images/42/70259/iphone-6-plus-64gb-3-400x460.png" alt="">
                </div>
                <p class="tensp">Iphone 6</p>
                <div class="gia">
                    <span class="giaGoc">6000000đ</span>
                    <span class="giaBan">5500000đ</span>
                </div>
                <input type="number" class="soLuong" value="1">
                <p class="tongTien">5500000đ</p>
                <div class="hanhDong">
                    <i class="fas fa-trash"></i>
                </div>
            </div>
        </div>
        <div>
            <form class="customer-info">
                <h1 class="cart-title">THÔNG TIN KHÁCH HÀNG</h1>
                <label for="hoten">Họ tên</label>
                <input type="text" name="hoten" id="hoten">
                <label for="phonenumber">Số điện thoại</label>
                <input type="number" name="phonenumber" id="phonenumber">
                <label for="email">Email</label>
                <input type="email" name="email" id="email">
                <label for="email">Địa chỉ nhận hàng</label>
                <input type="email" name="email" id="email">
                <label for="ngaysinh">Ngày sinh</label>
                <input type="date" name="ngaysinh" id="ngaysinh">
                <label for="thoigiannhanhang">Thời gian nhận hàng</label>
                <input type="number" name="thoigiannhanhang" id="thoigiannhanhang" min="2" max="14">
                <input type="submit" class="btn btn-primary" value="Xác nhận thanh toán">
            </form>
        </div>             
    </main>
    <footer id="footer">

    </footer>
    <script>
        hienThiDanhSachItemGioHang();
        
        function hienThiDanhSachItemGioHang(){
            var danhSachItemGioHang = layGioHangTuLCS();
            var HTML = chuyenDanhSachItemGioHangSangHTML(danhSachItemGioHang);
            
            var nodeGioHang = document.getElementById('gioHang');
            nodeGioHang.innerHTML =  HTML;
        }
        function chuyenDanhSachItemGioHangSangHTML(danhSachItemGioHang){
            var htmlTong = '';
            for(var i = 0; i < danhSachItemGioHang.length; i++){
                htmlTong = htmlTong + chuyenDoiTuongItemGioHangSangHTML(danhSachItemGioHang[i]);
            }
            return htmlTong;
        }
        function chuyenDoiTuongItemGioHangSangHTML(itemGioHang){
            var sanPham = laySanPhamTheoId(itemGioHang.idSanPham);
            console.log(sanPham);
            var tongTien = ((sanPham.tinhGiaBan())*itemGioHang.soLuong);
            var html =  '   <div id="itemhang" class="item-giohang">  '  + 
                '                <div class="hinhanh">  '  + 
                '                    <img src="'+ sanPham.hinhAnh +'" alt="">  '  + 
                '                </div>  '  + 
                '                <p class="tensp">'+ sanPham.ten +'</p>  '  + 
                '                <div class="gia">  '  + 
                '                    <span class="giaGoc">'+ themChamVaoSo(sanPham.giaGoc) +' đ</span>  '  + 
                '                    <span class="giaBan">'+ themChamVaoSo(sanPham.tinhGiaBan()) +' đ</span>  '  + 
                '                </div>  '  + 
                '                <input type="number" oninput="tinhTienSanPham('+itemGioHang.idSanPham+')" class="soLuong" value="'+ itemGioHang.soLuong +'">  '  + 
                '                <p class="tongTien">'+ themChamVaoSo(tongTien) +'đ</p>  '  + 
                '                <div class="hanhDong">  '  + 
                '                    <i class="fas fa-trash" onclick="onClickNutXoa('+itemGioHang.idSanPham+')"></i>  '  + 
                '                </div>  '  + 
                '           </div>  ' ; 
            return html;   
        }
        //Xoá sp
        function xoaSanPham(){
            var child = document.getElementById('itemhang');
            child.parentNode.removeChild(child);  
        }
        function onClickNutXoa(id) {
            // Xóa node hiển thị
            let nodeSanPham = event.target.parentElement;
            console.log(nodeSanPham.parentElement);
            nodeSanPham.parentElement.remove();
            // Xóa data
            let dataGioHang = layGioHangTuLCS("gioHang");
            let vitri = dataGioHang.findIndex(sp => sp.idSanPham == id);
            console.log(dataGioHang[vitri]);
            dataGioHang.splice(vitri, 1);
            luuDanhSachItemGioHangVaoLCS(dataGioHang, "gioHang");
            //tính tổng tiền
            // Tính lại tổng tiền
            let nodeTongTien = document.getElementById("tongTien");
            nodeTongTien.innerHTML = themChamVaoSo(tinhThanhTien(dataGioHang)) + " đ";            
        }
        function tinhThanhTien(dataGioHang){
            let dataSanPham = layGioHangTuLCS('danhSachSanPham');
            let tongTien = 0;
            for(var i=0; i<dataGioHang.length; i++){
                let idSanPham = dataGioHang[i].id;
                let soLuong = dataGioHang[i].soLuong;
                let sanPham = dataSanPham.find(sp => sp.id == idSanPham);
                let giaBan = tinhGiaBan(sanPham.giaGoc, sanPham.phanTramGiamGia);
                tongTien += giaBan * soLuong;
            }
            return tongTien;

        }
        function tinhTienSanPham(idSanPham){

        }
    </script>
</body>
</html>